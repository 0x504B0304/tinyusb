language: c
dist: xenial
compiler:
  - gcc

addons:
  apt:
    sources:
      - sourceline: "ppa:team-gcc-arm-embedded/ppa"
    packages:
      - python3
      - ruby
      - gcc-arm-embedded

install:
  - gem install ceedling
      
before_script:
  - arm-none-eabi-gcc --version

script:
  # Build all examples
  - python3 tools/build_all.py
  # Run unit tests
  - cd test
  - ceedling test:all
  
after_success:
  # Trigger mynewt-tinyusb-example repo each push
  - "curl -s -X POST -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Travis-API-Version: 3' -H 'Authorization: token $TRAVIS_TOKEN' -d '{ \"request\": { \"branch\":\"master\" }}' https://api.travis-ci.com/repo/hathach%2Fmynewt-tinyusb-example/requests"
